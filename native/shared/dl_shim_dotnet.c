#include "dl_shim_base.h"

// I noticed that bsd would sometimes crash when running the nro multiple times.
// This should have been fixed now but regardless, we only initialize sockets once if actually needed.
int32_t SystemNative_Socket_Hook(int32_t addressFamily, int32_t socketType, int32_t protocolType, intptr_t* createdSocket)
{
    extern void socket_esnure_init_thread_safe();
    extern int32_t SystemNative_Socket(int32_t addressFamily, int32_t socketType, int32_t protocolType, intptr_t* createdSocket);

    socket_esnure_init_thread_safe();
    return SystemNative_Socket(addressFamily, socketType, protocolType, createdSocket);
}

void *getsym_SystemNative(const char *name)
{
    SYM_RESOLVE_EXISTING_NAMED("SystemNative_Socket", SystemNative_Socket_Hook);

    SYM_RESOLVE(SystemNative_CreateAutoreleasePool);
    SYM_RESOLVE(SystemNative_DrainAutoreleasePool);
    SYM_RESOLVE(SystemNative_GetWindowSize);
    SYM_RESOLVE(SystemNative_IsATty);
    SYM_RESOLVE(SystemNative_InitializeTerminalAndSignalHandling);
    SYM_RESOLVE(SystemNative_SetKeypadXmit);
    SYM_RESOLVE(SystemNative_GetControlCharacters);
    SYM_RESOLVE(SystemNative_StdinReady);
    SYM_RESOLVE(SystemNative_InitializeConsoleBeforeRead);
    SYM_RESOLVE(SystemNative_UninitializeConsoleAfterRead);
    SYM_RESOLVE(SystemNative_ConfigureTerminalForChildProcess);
    SYM_RESOLVE(SystemNative_ReadStdin);
    SYM_RESOLVE(SystemNative_GetSignalForBreak);
    SYM_RESOLVE(SystemNative_SetSignalForBreak);
    SYM_RESOLVE(SystemNative_GetSystemTimeAsTicks);
    SYM_RESOLVE(SystemNative_GetDefaultTimeZone);
    SYM_RESOLVE(SystemNative_GetTimeZoneData);
    SYM_RESOLVE(SystemNative_LoadLibrary);
    SYM_RESOLVE(SystemNative_GetLoadLibraryError);
    SYM_RESOLVE(SystemNative_GetProcAddress);
    SYM_RESOLVE(SystemNative_FreeLibrary);
    SYM_RESOLVE(SystemNative_GetDefaultSearchOrderPseudoHandle);
    SYM_RESOLVE(SystemNative_GetEnv);
    SYM_RESOLVE(SystemNative_GetEnviron);
    SYM_RESOLVE(SystemNative_FreeEnviron);
    SYM_RESOLVE(SystemNative_ConvertErrorPlatformToPal);
    SYM_RESOLVE(SystemNative_ConvertErrorPalToPlatform);
    SYM_RESOLVE(SystemNative_StrErrorR);
    SYM_RESOLVE(SystemNative_GetErrNo);
    SYM_RESOLVE(SystemNative_SetErrNo);
    SYM_RESOLVE(SystemNative_EnumerateInterfaceAddresses);
    SYM_RESOLVE(SystemNative_GetNetworkInterfaces);
    SYM_RESOLVE(SystemNative_EnumerateGatewayAddressesForInterface);
    SYM_RESOLVE(SystemNative_FStat);
    SYM_RESOLVE(SystemNative_Stat);
    SYM_RESOLVE(SystemNative_LStat);
    SYM_RESOLVE(SystemNative_Open);
    SYM_RESOLVE(SystemNative_Close);
    SYM_RESOLVE(SystemNative_Dup);
    SYM_RESOLVE(SystemNative_Unlink);
    SYM_RESOLVE(SystemNative_ShmOpen);
    SYM_RESOLVE(SystemNative_ShmUnlink);
    SYM_RESOLVE(SystemNative_GetReadDirRBufferSize);
    SYM_RESOLVE(SystemNative_ReadDirR);
    SYM_RESOLVE(SystemNative_OpenDir);
    SYM_RESOLVE(SystemNative_CloseDir);
    SYM_RESOLVE(SystemNative_Pipe);
    SYM_RESOLVE(SystemNative_FcntlSetFD);
    SYM_RESOLVE(SystemNative_FcntlGetFD);
    SYM_RESOLVE(SystemNative_FcntlCanGetSetPipeSz);
    SYM_RESOLVE(SystemNative_FcntlGetPipeSz);
    SYM_RESOLVE(SystemNative_FcntlSetPipeSz);
    SYM_RESOLVE(SystemNative_FcntlSetIsNonBlocking);
    SYM_RESOLVE(SystemNative_FcntlGetIsNonBlocking);
    SYM_RESOLVE(SystemNative_MkDir);
    SYM_RESOLVE(SystemNative_ChMod);
    SYM_RESOLVE(SystemNative_FChMod);
    SYM_RESOLVE(SystemNative_FSync);
    SYM_RESOLVE(SystemNative_FLock);
    SYM_RESOLVE(SystemNative_ChDir);
    SYM_RESOLVE(SystemNative_Access);
    SYM_RESOLVE(SystemNative_LSeek);
    SYM_RESOLVE(SystemNative_Link);
    SYM_RESOLVE(SystemNative_SymLink);
    SYM_RESOLVE(SystemNative_GetDeviceIdentifiers);
    SYM_RESOLVE(SystemNative_MkNod);
    SYM_RESOLVE(SystemNative_MkFifo);
    SYM_RESOLVE(SystemNative_MkdTemp);
    SYM_RESOLVE(SystemNative_MksTemps);
    SYM_RESOLVE(SystemNative_MMap);
    SYM_RESOLVE(SystemNative_MUnmap);
    SYM_RESOLVE(SystemNative_MProtect);
    SYM_RESOLVE(SystemNative_MAdvise);
    SYM_RESOLVE(SystemNative_MSync);
    SYM_RESOLVE(SystemNative_SysConf);
    SYM_RESOLVE(SystemNative_FTruncate);
    SYM_RESOLVE(SystemNative_Poll);
    SYM_RESOLVE(SystemNative_PosixFAdvise);
    SYM_RESOLVE(SystemNative_FAllocate);
    SYM_RESOLVE(SystemNative_Read);
    SYM_RESOLVE(SystemNative_ReadLink);
    SYM_RESOLVE(SystemNative_Rename);
    SYM_RESOLVE(SystemNative_RmDir);
    SYM_RESOLVE(SystemNative_Sync);
    SYM_RESOLVE(SystemNative_Write);
    SYM_RESOLVE(SystemNative_CopyFile);
    SYM_RESOLVE(SystemNative_INotifyInit);
    SYM_RESOLVE(SystemNative_INotifyAddWatch);
    SYM_RESOLVE(SystemNative_INotifyRemoveWatch);
    SYM_RESOLVE(SystemNative_RealPath);
    SYM_RESOLVE(SystemNative_GetPeerID);
    SYM_RESOLVE(SystemNative_GetFileSystemType);
    SYM_RESOLVE(SystemNative_LockFileRegion);
    SYM_RESOLVE(SystemNative_LChflags);
    SYM_RESOLVE(SystemNative_FChflags);
    SYM_RESOLVE(SystemNative_LChflagsCanSetHiddenFlag);
    SYM_RESOLVE(SystemNative_CanGetHiddenFlag);
    SYM_RESOLVE(SystemNative_ReadProcessStatusInfo);
    SYM_RESOLVE(SystemNative_PRead);
    SYM_RESOLVE(SystemNative_PWrite);
    SYM_RESOLVE(SystemNative_PReadV);
    SYM_RESOLVE(SystemNative_PWriteV);
    SYM_RESOLVE(SystemNative_iOSSupportVersion);
    SYM_RESOLVE(SystemNative_Log);
    SYM_RESOLVE(SystemNative_LogError);
    SYM_RESOLVE(SystemNative_AlignedAlloc);
    SYM_RESOLVE(SystemNative_AlignedFree);
    SYM_RESOLVE(SystemNative_AlignedRealloc);
    SYM_RESOLVE(SystemNative_Calloc);
    SYM_RESOLVE(SystemNative_Free);
    SYM_RESOLVE(SystemNative_Malloc);
    SYM_RESOLVE(SystemNative_Realloc);
    SYM_RESOLVE(SystemNative_GetSpaceInfoForMountPoint);
    SYM_RESOLVE(SystemNative_GetFormatInfoForMountPoint);
    SYM_RESOLVE(SystemNative_GetAllMountPoints);
    SYM_RESOLVE(SystemNative_GetHostEntryForName);
    SYM_RESOLVE(SystemNative_FreeHostEntry);
    SYM_RESOLVE(SystemNative_GetNameInfo);
    SYM_RESOLVE(SystemNative_GetDomainName);
    SYM_RESOLVE(SystemNative_GetHostName);
    SYM_RESOLVE(SystemNative_GetSocketAddressSizes);
    SYM_RESOLVE(SystemNative_GetAddressFamily);
    SYM_RESOLVE(SystemNative_SetAddressFamily);
    SYM_RESOLVE(SystemNative_GetPort);
    SYM_RESOLVE(SystemNative_SetPort);
    SYM_RESOLVE(SystemNative_GetIPv4Address);
    SYM_RESOLVE(SystemNative_SetIPv4Address);
    SYM_RESOLVE(SystemNative_GetIPv6Address);
    SYM_RESOLVE(SystemNative_SetIPv6Address);
    SYM_RESOLVE(SystemNative_GetControlMessageBufferSize);
    SYM_RESOLVE(SystemNative_TryGetIPPacketInformation);
    SYM_RESOLVE(SystemNative_GetIPv4MulticastOption);
    SYM_RESOLVE(SystemNative_SetIPv4MulticastOption);
    SYM_RESOLVE(SystemNative_GetIPv6MulticastOption);
    SYM_RESOLVE(SystemNative_SetIPv6MulticastOption);
    SYM_RESOLVE(SystemNative_GetLingerOption);
    SYM_RESOLVE(SystemNative_SetLingerOption);
    SYM_RESOLVE(SystemNative_SetReceiveTimeout);
    SYM_RESOLVE(SystemNative_SetSendTimeout);
    SYM_RESOLVE(SystemNative_Receive);
    SYM_RESOLVE(SystemNative_ReceiveMessage);
    SYM_RESOLVE(SystemNative_Send);
    SYM_RESOLVE(SystemNative_SendMessage);
    SYM_RESOLVE(SystemNative_Accept);
    SYM_RESOLVE(SystemNative_Bind);
    SYM_RESOLVE(SystemNative_Connect);
    SYM_RESOLVE(SystemNative_GetPeerName);
    SYM_RESOLVE(SystemNative_GetSockName);
    SYM_RESOLVE(SystemNative_Listen);
    SYM_RESOLVE(SystemNative_Shutdown);
    SYM_RESOLVE(SystemNative_GetSocketErrorOption);
    SYM_RESOLVE(SystemNative_GetSockOpt);
    SYM_RESOLVE(SystemNative_GetRawSockOpt);
    SYM_RESOLVE(SystemNative_SetSockOpt);
    SYM_RESOLVE(SystemNative_SetRawSockOpt);
    SYM_RESOLVE(SystemNative_GetSocketType);
    SYM_RESOLVE(SystemNative_GetAtOutOfBandMark);
    SYM_RESOLVE(SystemNative_GetBytesAvailable);
    SYM_RESOLVE(SystemNative_CreateSocketEventPort);
    SYM_RESOLVE(SystemNative_CloseSocketEventPort);
    SYM_RESOLVE(SystemNative_CreateSocketEventBuffer);
    SYM_RESOLVE(SystemNative_FreeSocketEventBuffer);
    SYM_RESOLVE(SystemNative_TryChangeSocketEventRegistration);
    SYM_RESOLVE(SystemNative_WaitForSocketEvents);
    SYM_RESOLVE(SystemNative_PlatformSupportsDualModeIPv4PacketInfo);
    SYM_RESOLVE(SystemNative_GetDomainSocketSizes);
    SYM_RESOLVE(SystemNative_GetMaximumAddressSize);
    SYM_RESOLVE(SystemNative_SendFile);
    SYM_RESOLVE(SystemNative_Disconnect);
    SYM_RESOLVE(SystemNative_InterfaceNameToIndex);
    SYM_RESOLVE(SystemNative_GetTcpGlobalStatistics);
    SYM_RESOLVE(SystemNative_GetIPv4GlobalStatistics);
    SYM_RESOLVE(SystemNative_GetUdpGlobalStatistics);
    SYM_RESOLVE(SystemNative_GetIcmpv4GlobalStatistics);
    SYM_RESOLVE(SystemNative_GetIcmpv6GlobalStatistics);
    SYM_RESOLVE(SystemNative_GetEstimatedTcpConnectionCount);
    SYM_RESOLVE(SystemNative_GetActiveTcpConnectionInfos);
    SYM_RESOLVE(SystemNative_GetEstimatedUdpListenerCount);
    SYM_RESOLVE(SystemNative_GetActiveUdpListeners);
    SYM_RESOLVE(SystemNative_GetNativeIPInterfaceStatistics);
    SYM_RESOLVE(SystemNative_GetNumRoutes);
    SYM_RESOLVE(SystemNative_ForkAndExecProcess);
    SYM_RESOLVE(SystemNative_GetRLimit);
    SYM_RESOLVE(SystemNative_SetRLimit);
    SYM_RESOLVE(SystemNative_Kill);
    SYM_RESOLVE(SystemNative_GetPid);
    SYM_RESOLVE(SystemNative_GetSid);
    SYM_RESOLVE(SystemNative_SysLog);
    SYM_RESOLVE(SystemNative_WaitIdAnyExitedNoHangNoWait);
    SYM_RESOLVE(SystemNative_WaitPidExitedNoHang);
    SYM_RESOLVE(SystemNative_PathConf);
    SYM_RESOLVE(SystemNative_GetPriority);
    SYM_RESOLVE(SystemNative_SetPriority);
    SYM_RESOLVE(SystemNative_GetCwd);
    SYM_RESOLVE(SystemNative_SchedSetAffinity);
    SYM_RESOLVE(SystemNative_SchedGetAffinity);
    SYM_RESOLVE(SystemNative_GetProcessPath);
    SYM_RESOLVE(SystemNative_GetNonCryptographicallySecureRandomBytes);
    SYM_RESOLVE(SystemNative_GetCryptographicallySecureRandomBytes);
    SYM_RESOLVE(SystemNative_GetUnixRelease);
    SYM_RESOLVE(SystemNative_GetUnixVersion);
    SYM_RESOLVE(SystemNative_GetOSArchitecture);
    SYM_RESOLVE(SystemNative_SearchPath);
    SYM_RESOLVE(SystemNative_SearchPath_TempDirectory);
    SYM_RESOLVE(SystemNative_RegisterForSigChld);
    SYM_RESOLVE(SystemNative_SetDelayedSigChildConsoleConfigurationHandler);
    SYM_RESOLVE(SystemNative_SetTerminalInvalidationHandler);
    SYM_RESOLVE(SystemNative_SetPosixSignalHandler);
    SYM_RESOLVE(SystemNative_EnablePosixSignalHandling);
    SYM_RESOLVE(SystemNative_DisablePosixSignalHandling);
    SYM_RESOLVE(SystemNative_HandleNonCanceledPosixSignal);
    SYM_RESOLVE(SystemNative_InitializeTerminalAndSignalHandling);
    SYM_RESOLVE(SystemNative_SNPrintF);
    SYM_RESOLVE(SystemNative_SNPrintF_1S);
    SYM_RESOLVE(SystemNative_SNPrintF_1I);
    SYM_RESOLVE(SystemNative_Sysctl);
    SYM_RESOLVE(SystemNative_MapTcpState);
    SYM_RESOLVE(SystemNative_LowLevelMonitor_Create);
    SYM_RESOLVE(SystemNative_LowLevelMonitor_Destroy);
    SYM_RESOLVE(SystemNative_LowLevelMonitor_Acquire);
    SYM_RESOLVE(SystemNative_LowLevelMonitor_Release);
    SYM_RESOLVE(SystemNative_LowLevelMonitor_Wait);
    SYM_RESOLVE(SystemNative_LowLevelMonitor_TimedWait);
    SYM_RESOLVE(SystemNative_LowLevelMonitor_Signal_Release);
    SYM_RESOLVE(SystemNative_CreateThread);
    SYM_RESOLVE(SystemNative_SchedGetCpu);
    SYM_RESOLVE(SystemNative_Exit);
    SYM_RESOLVE(SystemNative_Abort);
    SYM_RESOLVE(SystemNative_GetUInt64OSThreadId);
    SYM_RESOLVE(SystemNative_TryGetUInt32OSThreadId);
    SYM_RESOLVE(SystemNative_UTimensat);
    SYM_RESOLVE(SystemNative_FUTimens);
    SYM_RESOLVE(SystemNative_GetTimestamp);
    SYM_RESOLVE(SystemNative_GetBootTimeTicks);
    SYM_RESOLVE(SystemNative_GetCpuUtilization);
    SYM_RESOLVE(SystemNative_GetPwUidR);
    SYM_RESOLVE(SystemNative_GetPwNamR);
    SYM_RESOLVE(SystemNative_GetEUid);
    SYM_RESOLVE(SystemNative_GetEGid);
    SYM_RESOLVE(SystemNative_SetEUid);
    SYM_RESOLVE(SystemNative_GetGroupList);
    SYM_RESOLVE(SystemNative_GetGroups);
    SYM_RESOLVE(SystemNative_GetGroupName);
    return NULL;
}

void *getsym_GlobalizationNative(const char *name)
{
    SYM_RESOLVE(GlobalizationNative_GetCalendars);
    SYM_RESOLVE(GlobalizationNative_GetCalendarInfo);
    SYM_RESOLVE(GlobalizationNative_EnumCalendarInfo);
    SYM_RESOLVE(GlobalizationNative_GetLatestJapaneseEra);
    SYM_RESOLVE(GlobalizationNative_GetJapaneseEraStartDate);
    SYM_RESOLVE(GlobalizationNative_InitOrdinalCasingPage);
    SYM_RESOLVE(GlobalizationNative_ChangeCase);
    SYM_RESOLVE(GlobalizationNative_ChangeCaseInvariant);
    SYM_RESOLVE(GlobalizationNative_ChangeCaseTurkish);
    SYM_RESOLVE(GlobalizationNative_GetSortHandle);
    SYM_RESOLVE(GlobalizationNative_CloseSortHandle);
    SYM_RESOLVE(GlobalizationNative_GetSortVersion);
    SYM_RESOLVE(GlobalizationNative_CompareString);
    SYM_RESOLVE(GlobalizationNative_IndexOf);
    SYM_RESOLVE(GlobalizationNative_LastIndexOf);
    SYM_RESOLVE(GlobalizationNative_StartsWith);
    SYM_RESOLVE(GlobalizationNative_EndsWith);
    SYM_RESOLVE(GlobalizationNative_GetSortKey);
    SYM_RESOLVE(GlobalizationNative_LoadICU);
    SYM_RESOLVE(GlobalizationNative_InitICUFunctions);
    SYM_RESOLVE(GlobalizationNative_GetICUVersion);
    SYM_RESOLVE(GlobalizationNative_LoadICUData);
    SYM_RESOLVE(GlobalizationNative_ToAscii);
    SYM_RESOLVE(GlobalizationNative_ToUnicode);
    SYM_RESOLVE(GlobalizationNative_GetLocales);
    SYM_RESOLVE(GlobalizationNative_GetLocaleName);
    SYM_RESOLVE(GlobalizationNative_GetDefaultLocaleName);
    SYM_RESOLVE(GlobalizationNative_IsPredefinedLocale);
    SYM_RESOLVE(GlobalizationNative_GetLocaleTimeFormat);
    SYM_RESOLVE(GlobalizationNative_GetLocaleInfoInt);
    SYM_RESOLVE(GlobalizationNative_GetLocaleInfoGroupingSizes);
    SYM_RESOLVE(GlobalizationNative_GetLocaleInfoString);
    SYM_RESOLVE(GlobalizationNative_IsNormalized);
    SYM_RESOLVE(GlobalizationNative_NormalizeString);
    SYM_RESOLVE(GlobalizationNative_WindowsIdToIanaId);
    SYM_RESOLVE(GlobalizationNative_IanaIdToWindowsId);
    SYM_RESOLVE(GlobalizationNative_GetTimeZoneDisplayName);
    return NULL;
}